# 中传放心传

本项目是 [中国传媒大学密码学应用实践课程](https://c4pr1c3.github.io/cuc-wiki/ac.html) 的一个样例工程下的二次开发项目。

## 功能清单

- 基于网页的用户注册与登录系统
  - 使用https绑定证书到域名而非IP地址 【 *PKI* *X.509* 】
  - 允许用户注册到系统
    - 用户名的合法字符集范围：中文、英文字母、数字
      - 类似：-、_、.等合法字符集范围之外的字符不允许使用
    - 用户口令长度限制在36个字符之内
    - 对用户输入的口令进行强度校验，禁止使用弱口令
  - 使用合法用户名和口令登录系统
  - 禁止使用明文存储用户口令 【 PBKDF2  散列算法  慢速散列  针对散列算法（如MD5、SHA1等）的攻击方法 】
    - 存储的口令即使被公开，也无法还原/解码出原始明文口令
  - （可选）安全的忘记口令 / 找回密码功能
  - （可选）微信/微博/支付宝的OAuth授权登录 / 注册绑定
  - （可选）双因素认证
    - OTP: Google Authenticator
    - Email
    - SMS
    - 扫码登录
- 基于网页的文件上传加密与数字签名系统
  - 已完成《基于网页的用户注册与登录系统》所有要求
  - 限制文件大小：小于 10MB
  - 限制文件类型：office文档、常见图片类型
  - 匿名用户禁止上传文件
  - 对文件进行对称加密存储到文件系统，禁止明文存储文件 【 *对称加密* *密钥管理（如何安全存储对称加密密钥）* *对称加密密文的PADDING问题* 】
  - 系统对加密后文件进行数字签名 【 *数字签名（多种签名工作模式差异）* 】
  - （可选）文件秒传：服务器上已有的文件，客户端可以不必再重复上传了
- 基于网页的加密文件下载与解密（20分）
  - 已完成《基于网页的文件上传加密与数字签名系统》所有要求
  - 提供匿名用户加密后文件和关联的数字签名文件的下载
    - 客户端对下载后的文件进行数字签名验证 【 *非对称（公钥）加密* *数字签名* 】
    - 客户端对下载后的文件可以解密还原到原始文件 【 *对称解密* *密钥管理* 】
  - 提供已登录用户解密后文件下载
  - 下载URL设置有效期（限制时间或限制下载次数），过期后禁止访问 【 *数字签名* *消息认证码* *Hash Extension Length Attack* *Hash算法与HMAC算法的区别与联系* 】
  - 提供静态文件的散列值下载，供下载文件完成后本地校验文件完整性 【 *散列算法* 】

## 本项目用到的关键技术

| 密码学理论 | 要点说明                                                     |
| ---------- | ------------------------------------------------------------ |
| 对称加密   | 对用户的对称密钥以及对所上传文件进行对称加密后存储，避免明文直接存储 |
| 哈希函数   | 使用sha512对所上传文件进行哈希并存储哈希值，保证文件的完整性以及后续完整性验证 |
| RSA签名    | 用户对所上传文件进行私钥签名，保证文件的真实性               |

## 问题清单

##### 如何实现安全的文件上传

文件上传后，先对文件进行哈希，通过对比判断文件是否已经存在。若文件不存在，则用对称密钥对上传的文件进行加密，并用私钥来对文件进行签名，存储哈希值、密文和签名，确保文件的完整性和真实性。


##### 同一个用户的不同文件是否使用相同的对称加密密钥？

同一个用户的不同文件使用相同的对称加密密钥，密钥泄露会造成很大的安全隐患，保密安全性较低。

##### 常见对称加密工作模式有哪些？各自应用场景、优缺点说明。

- 电子密码本模式ECB

  最早采用和最简单的模式，它将加密的数据分成若干组，每组的大小跟加密密钥长度相同，然后每组都用相同的密钥进行加密。

  优点:算法简单，有利于并行计算，且误差不会被传送；

  缺点:电子编码薄模式用一个密钥加密消息的所有块，如果原消息中重复明文块，则加密消息中的相应密文块也会重复，容易对明文进行主动的攻击。所以，电子编码薄模式适于加密小消息。

- 加密块链模式CBC

  将明文分成固定长度的块，然后将前面一个加密块输出的密文与下一个要加密的明文块进行异或操作，将计算的结果再用密钥进行加密得到密文。

  优点：不容易主动攻击,安全性好于ECB,适合传输长度长的报文,是SSL、IPSec的标准。

  缺点：密文不利于并行计算，容易造成误差传递，且需要初始化向量IV。

- 加密反馈模式CFB

  适用于面向字符应用程序，要使用流加密算法的加密。在此模式下，数据用更小的单元加密，如可以是8位，这个长度小于定义的块长（通常 64 位）

  优点：分组密码转化为流模式，隐藏了明文模式，可以及时加密传送小于分组的数据。

  缺点:密文不利于并行计算，如果一个明文单元损坏，则会影响多个密文单元，需要唯一的初始化向量。

- 输出反馈模式OFB

  初始化向量加密过程的输入填入加密过程下一阶段

  优点:分组密码转化为流模式，隐藏了明文模式，可以及时加密传送小于分组的数据。

  缺点:密文不利于并行计算，如果一个明文单元损坏，则会影响多个密文单元，且对明文的主动攻击是可能的。


##### 简述RSA加密算法和RSA签名算法之间的关系？

RSA公钥加密体制包含如下3个算法：KeyGen（密钥生成算法），Encrypt（加密算法）以及Decrypt（解密算法）

RSA签名体制包含3个算法：KeyGen（密钥生成算法），Sign（签名算法），Verify（验证算法）

RSA加密解密系统中，加密函数称为E，解码函数称为D。

在加密过程中，使用公钥PK和E函数，将报文加密，然后在对端使用私钥SK和D函数将密文解密，得到原始的报文。在签名认证的过程中，使用私钥SK和D函数进行报文的签名，然后在对端使用公钥PK和E函数进行认证。并且加密算法和签名算法使用的函数D和E是一样的。

##### 通过Python 实现文件散列值计算有哪些方法？

使用hashlib库，主要方法有md5,sha1,sha224,sha256,sha512等

##### 你们是如何实现匿名用户禁止上传文件功能的？

未登录用户无法进入到上传文件的界面，退出登录后直接返回登录界面，要进行上传文件先要进行登录。

## 快速安装与使用方法说明

安装docker环境，将实例代码克隆到本地，输入命令`docker compose up -d -build`

安装成功输入`docker start ac_flask`在浏览器中打开网页，打开浏览器访问： [https://127.0.0.1](https://127.0.0.1)即可快速体验系统所有功能。

## 课程结题报告与系统功能操作视频演示地址